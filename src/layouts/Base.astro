---
/**
 * Base Layout
 *
 * The foundation HTML shell for all pages. Handles:
 * - HTML document structure
 * - Theme initialization (cosmic dark theme)
 * - Font preloading (conditional for Hindi pages)
 * - Grain texture overlay
 * - Critical meta tags
 *
 * Usage:
 * <Base title="Page Title" lang="en">
 *   <SEO slot="head" ... />
 *   <Header />
 *   <main>Content</main>
 *   <Footer />
 * </Base>
 */

import '../styles/global.css';

interface Props {
  /** Page title (displayed in browser tab) */
  title: string;
  /** Optional meta description */
  description?: string;
  /** Language code: 'en' or 'hi' */
  lang?: 'en' | 'hi';
  /** Additional classes for body element */
  class?: string;
  /** Whether to show grain overlay (default: true) */
  showGrain?: boolean;
}

const {
  title,
  description,
  lang = 'en',
  class: className,
  showGrain = true,
} = Astro.props;
---

<!DOCTYPE html>
<html lang={lang} data-theme="cosmic" class:list={[showGrain && 'grain-overlay']}>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <!-- Theme color for mobile browser UI -->
  <meta name="theme-color" content="#0F0E1A" />
  <meta name="color-scheme" content="dark" />

  <!-- Default title (can be overridden by SEO component) -->
  <title>{title}</title>
  {description && <meta name="description" content={description} />}

  <!-- Preload critical font (regular weight used on every page) -->
  <link
    rel="preload"
    href="/fonts/inter-400.woff2"
    as="font"
    type="font/woff2"
    crossorigin="anonymous"
  />

  <!-- Preload Devanagari font only on Hindi pages -->
  {lang === 'hi' && (
    <link
      rel="preload"
      href="/fonts/noto-sans-devanagari-400.woff2"
      as="font"
      type="font/woff2"
      crossorigin="anonymous"
    />
  )}

  <!-- Favicon -->
  <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />

  <!-- Google Analytics (production only) -->
  {import.meta.env.PROD && (
    <>
      <script is:inline async src="https://www.googletagmanager.com/gtag/js?id=G-W10Q8N9937"></script>
      <script is:inline>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-W10Q8N9937');
      </script>
    </>
  )}

  <!-- Slot for additional head content (SEO component, custom meta, etc.) -->
  <slot name="head" />
</head>

<body class:list={[
  'min-h-screen',
  'bg-base-100',
  'text-base-content',
  'antialiased',
  className
]}>
  <!-- Skip to main content link for accessibility -->
  <a
    href="#main-content"
    class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary focus:text-primary-content focus:rounded-lg"
  >
    Skip to main content
  </a>

  <!-- Page content -->
  <slot />

  <!-- Slot for scripts (analytics, etc.) -->
  <slot name="scripts" />
</body>
</html>

<style is:global>
  /* Ensure smooth scrolling behavior */
  html {
    scroll-behavior: smooth;
  }

  /* Ensure body takes full height */
  body {
    min-height: 100vh;
    min-height: 100dvh; /* Dynamic viewport height for mobile */
  }

  /* Screen reader only class */
  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border-width: 0;
  }
</style>
