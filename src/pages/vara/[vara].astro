---
/**
 * Individual Vara Page
 *
 * Detailed page for each vara (weekday) with:
 * - Ruling planet and deity
 * - Auspicious and inauspicious activities
 * - Fasting significance
 * - FAQ schema for AI extraction
 */
import Layout from '../../layouts/Layout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import type { BreadcrumbItem } from '../../lib/types';

// Load varas data
import varasData from '../../data/varas.json';

interface Vara {
  id: number;
  name: string;
  nameHindi: string;
  nameEnglish: string;
  slug: string;
  planet: string;
  planetHindi: string;
  planetSanskrit: string;
  deity: string;
  deityHindi: string;
  color: string;
  colorHindi: string;
  element: string;
  direction: string;
  metal: string;
  gemstone: string;
  nature: string;
  goodFor: string[];
  notGoodFor: string[];
  fasting: string;
  mantra: string;
  description: string;
}

const varas = varasData as Vara[];

// Generate static paths
export async function getStaticPaths() {
  const varasModule = await import('../../data/varas.json');
  const varas = varasModule.default as Vara[];

  return varas.map((vara) => ({
    params: { vara: vara.slug },
    props: { vara },
  }));
}

// Get vara from props
const { vara } = Astro.props as { vara: Vara };

// Page meta
const title = `${vara.name} (${vara.nameHindi}) - ${vara.nameEnglish} in Vedic Astrology | Shree Kundli`;
const description = `${vara.name} (${vara.nameHindi}) is ${vara.nameEnglish}, ruled by ${vara.planet} (${vara.planetHindi}). ${vara.description.slice(0, 120)}...`;

// Breadcrumbs
const breadcrumbs: BreadcrumbItem[] = [
  { name: 'Home', url: '/' },
  { name: 'Vara', url: '/vara' },
  { name: `${vara.nameHindi} (${vara.nameEnglish})` },
];

// Article schema
const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: `${vara.name} - ${vara.nameHindi} (${vara.nameEnglish})`,
  description: description,
  author: {
    '@type': 'Organization',
    name: 'Shree Kundli',
  },
  about: {
    '@type': 'Thing',
    name: `${vara.nameEnglish}`,
    alternateName: vara.nameHindi,
  },
  inLanguage: ['en', 'hi'],
};

// FAQ schema
const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: `What is ${vara.name} (${vara.nameEnglish})?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `${vara.name} (${vara.nameHindi}) is ${vara.nameEnglish} in Vedic astrology. It is ruled by ${vara.planet} (${vara.planetHindi}). ${vara.description}`,
      },
    },
    {
      '@type': 'Question',
      name: `Which planet rules ${vara.nameEnglish}?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `${vara.nameEnglish} (${vara.name}) is ruled by ${vara.planet} (${vara.planetHindi}/${vara.planetSanskrit}). The deity associated with this day is ${vara.deity}.`,
      },
    },
    {
      '@type': 'Question',
      name: `What activities are good on ${vara.nameEnglish}?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `Good activities on ${vara.nameEnglish} include: ${vara.goodFor.join(', ')}. ${vara.notGoodFor.length > 0 ? `Avoid: ${vara.notGoodFor.join(', ')}.` : ''}`,
      },
    },
    {
      '@type': 'Question',
      name: `What is the significance of fasting on ${vara.nameEnglish}?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: vara.fasting,
      },
    },
  ],
};

// Get adjacent varas for navigation
const currentIndex = varas.findIndex(v => v.id === vara.id);
const prevVara = varas[currentIndex - 1] || varas[varas.length - 1];
const nextVara = varas[currentIndex + 1] || varas[0];

// Planet colors for styling
const planetColors: Record<string, string> = {
  'Sun': 'bg-orange-500/10 text-orange-600 border-orange-500/20',
  'Moon': 'bg-slate-500/10 text-slate-600 border-slate-500/20',
  'Mars': 'bg-red-500/10 text-red-600 border-red-500/20',
  'Mercury': 'bg-green-500/10 text-green-600 border-green-500/20',
  'Jupiter': 'bg-yellow-500/10 text-yellow-600 border-yellow-500/20',
  'Venus': 'bg-pink-500/10 text-pink-600 border-pink-500/20',
  'Saturn': 'bg-blue-900/10 text-blue-900 border-blue-900/20',
};

// Planet symbols
const planetSymbols: Record<string, string> = {
  'Sun': '‚òÄÔ∏è',
  'Moon': 'üåô',
  'Mars': '‚ôÇÔ∏è',
  'Mercury': '‚òøÔ∏è',
  'Jupiter': '‚ôÉ',
  'Venus': '‚ôÄÔ∏è',
  'Saturn': '‚ôÑ',
};

// Nature styling
const isAuspicious = vara.nature === 'Highly Auspicious' || vara.nature === 'Auspicious';
---

<Layout title={title} description={description}>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(articleSchema)} slot="head" />
  <script is:inline type="application/ld+json" set:html={JSON.stringify(faqSchema)} slot="head" />

  <div class="space-y-8">
    <!-- Breadcrumb -->
    <Breadcrumb items={breadcrumbs} />

    <!-- Header -->
    <header>
      <div class="flex items-start gap-4">
        <div class={`text-center p-4 rounded-xl border ${planetColors[vara.planet]}`}>
          <span class="text-4xl">{planetSymbols[vara.planet]}</span>
          <p class="text-xs mt-1 opacity-60">{vara.planet}</p>
        </div>
        <div>
          <h1 class="font-heading text-3xl md:text-4xl text-primary font-bold">
            {vara.nameHindi}
          </h1>
          <p class="text-xl text-neutral/70 mt-1">
            {vara.name} ({vara.nameEnglish})
          </p>
          <p class="text-sm text-neutral/50 mt-2">
            Ruled by {vara.planetHindi} ({vara.planet}) ‚Ä¢ {vara.element} Element
          </p>
        </div>
      </div>
    </header>

    <!-- Quick Answer (AI Extraction Target) -->
    <section class="quick-answer" role="contentinfo">
      <div class={`card border ${planetColors[vara.planet]}`}>
        <div class="card-body p-4 md:p-6">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
              <p class="text-xs text-neutral/50 uppercase">Ruling Planet</p>
              <p class="font-semibold">{vara.planet}</p>
              <p class="text-sm opacity-70">{vara.planetHindi}</p>
            </div>
            <div>
              <p class="text-xs text-neutral/50 uppercase">Deity</p>
              <p class="font-semibold">{vara.deity.split(',')[0]}</p>
              <p class="text-sm opacity-70">{vara.deityHindi.split(',')[0]}</p>
            </div>
            <div>
              <p class="text-xs text-neutral/50 uppercase">Element</p>
              <p class="font-semibold">{vara.element}</p>
              <p class="text-sm opacity-70">{vara.direction}</p>
            </div>
            <div>
              <p class="text-xs text-neutral/50 uppercase">Nature</p>
              <p class={`font-semibold ${isAuspicious ? 'text-green-600' : vara.nature === 'Mixed' ? 'text-amber-600' : 'text-red-600'}`}>
                {vara.nature}
              </p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- About This Vara -->
    <section>
      <h2 class="font-heading text-2xl text-primary font-bold mb-4">
        About {vara.nameEnglish} ({vara.name})
      </h2>
      <div class="prose prose-neutral max-w-none">
        <p class="text-lg leading-relaxed">
          <strong>{vara.name}</strong> ({vara.nameHindi}) is {vara.nameEnglish} in the Vedic week.
          It is ruled by <strong>{vara.planet}</strong> ({vara.planetHindi}/{vara.planetSanskrit}).
        </p>
        <p class="text-neutral/70 mt-3">
          {vara.description}
        </p>
      </div>
    </section>

    <!-- Activities -->
    <section>
      <h2 class="font-heading text-2xl text-primary font-bold mb-4">
        Activities for {vara.nameEnglish}
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Good For -->
        <div class="card bg-green-500/5 border border-green-500/20">
          <div class="card-body p-4">
            <h3 class="font-semibold text-green-600 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
              Recommended Activities
            </h3>
            <ul class="space-y-2">
              {vara.goodFor.map((activity) => (
                <li class="flex items-start gap-2 text-sm">
                  <span class="text-green-500 mt-0.5">‚Ä¢</span>
                  <span class="text-neutral/70">{activity}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>

        <!-- Not Good For -->
        <div class="card bg-red-500/5 border border-red-500/20">
          <div class="card-body p-4">
            <h3 class="font-semibold text-red-600 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
              Things to Avoid
            </h3>
            <ul class="space-y-2">
              {vara.notGoodFor.length > 0 ? (
                vara.notGoodFor.map((activity) => (
                  <li class="flex items-start gap-2 text-sm">
                    <span class="text-red-500 mt-0.5">‚Ä¢</span>
                    <span class="text-neutral/70">{activity}</span>
                  </li>
                ))
              ) : (
                <li class="text-sm text-neutral/50">No specific restrictions</li>
              )}
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Fasting Section -->
    <section>
      <h2 class="font-heading text-xl text-primary font-semibold mb-4">
        {vara.nameEnglish} Fasting (Vrat)
      </h2>
      <div class="glass-elevated">
        <div class="p-4">
          <p class="text-neutral/80">{vara.fasting}</p>
          <div class="mt-4 p-3 bg-base-100 rounded-lg">
            <p class="text-sm text-neutral/60">Sacred Mantra</p>
            <p class="font-semibold text-primary text-lg">{vara.mantra}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Detailed Information -->
    <section>
      <h2 class="font-heading text-xl text-primary font-semibold mb-4">
        Detailed Information
      </h2>
      <div class="glass-card">
        <div class="card-body p-4">
          <table class="table table-sm">
            <tbody>
              <tr>
                <td class="text-neutral/60 w-40">Sanskrit Name</td>
                <td class="font-medium">{vara.name} ({vara.nameHindi})</td>
              </tr>
              <tr>
                <td class="text-neutral/60">English Name</td>
                <td class="font-medium">{vara.nameEnglish}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Ruling Planet</td>
                <td class="font-medium">
                  <span class="flex items-center gap-2">
                    {planetSymbols[vara.planet]} {vara.planet} ({vara.planetHindi} / {vara.planetSanskrit})
                  </span>
                </td>
              </tr>
              <tr>
                <td class="text-neutral/60">Deity</td>
                <td class="font-medium">{vara.deity} ({vara.deityHindi})</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Element</td>
                <td class="font-medium">{vara.element}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Direction</td>
                <td class="font-medium">{vara.direction}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Auspicious Colors</td>
                <td class="font-medium">{vara.color}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Metal</td>
                <td class="font-medium">{vara.metal}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Gemstone</td>
                <td class="font-medium">{vara.gemstone}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Nature</td>
                <td class={`font-medium ${isAuspicious ? 'text-green-600' : vara.nature === 'Mixed' ? 'text-amber-600' : ''}`}>
                  {vara.nature}
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Planetary Influence -->
    <section>
      <h2 class="font-heading text-xl text-primary font-semibold mb-4">
        {vara.planet}'s Influence on {vara.nameEnglish}
      </h2>
      <div class={`card border ${planetColors[vara.planet]}`}>
        <div class="card-body p-4">
          <div class="flex items-center gap-4 mb-4">
            <span class="text-5xl">{planetSymbols[vara.planet]}</span>
            <div>
              <h3 class="font-heading text-xl font-semibold">{vara.planet} ({vara.planetHindi})</h3>
              <p class="text-sm text-neutral/60">{vara.planetSanskrit} Graha</p>
            </div>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm">
            <div class="p-2 bg-base-100 rounded">
              <p class="text-neutral/50 text-xs">Gemstone</p>
              <p class="font-medium">{vara.gemstone}</p>
            </div>
            <div class="p-2 bg-base-100 rounded">
              <p class="text-neutral/50 text-xs">Metal</p>
              <p class="font-medium">{vara.metal}</p>
            </div>
            <div class="p-2 bg-base-100 rounded">
              <p class="text-neutral/50 text-xs">Colors</p>
              <p class="font-medium">{vara.color.split(',')[0]}</p>
            </div>
            <div class="p-2 bg-base-100 rounded">
              <p class="text-neutral/50 text-xs">Direction</p>
              <p class="font-medium">{vara.direction}</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section>
      <h2 class="font-heading text-2xl text-primary font-bold mb-4">
        Frequently Asked Questions
      </h2>
      <div class="space-y-4">
        <div class="collapse collapse-arrow glass-card">
          <input type="radio" name="faq" checked />
          <div class="collapse-title font-medium">
            What is {vara.name} ({vara.nameEnglish})?
          </div>
          <div class="collapse-content">
            <p>{vara.name} ({vara.nameHindi}) is {vara.nameEnglish} in Vedic astrology. It is ruled by {vara.planet} ({vara.planetHindi}). {vara.description}</p>
          </div>
        </div>

        <div class="collapse collapse-arrow glass-card">
          <input type="radio" name="faq" />
          <div class="collapse-title font-medium">
            Which planet rules {vara.nameEnglish}?
          </div>
          <div class="collapse-content">
            <p>{vara.nameEnglish} ({vara.name}) is ruled by {vara.planet} ({vara.planetHindi}/{vara.planetSanskrit}). The deity associated with this day is {vara.deity}. Wearing {vara.gemstone} and {vara.metal} items on this day is considered beneficial.</p>
          </div>
        </div>

        <div class="collapse collapse-arrow glass-card">
          <input type="radio" name="faq" />
          <div class="collapse-title font-medium">
            What activities are good on {vara.nameEnglish}?
          </div>
          <div class="collapse-content">
            <p>Good activities on {vara.nameEnglish} include: {vara.goodFor.join(', ')}. {vara.notGoodFor.length > 0 ? `It is advisable to avoid: ${vara.notGoodFor.join(', ')}.` : ''}</p>
          </div>
        </div>

        <div class="collapse collapse-arrow glass-card">
          <input type="radio" name="faq" />
          <div class="collapse-title font-medium">
            What is the significance of fasting on {vara.nameEnglish}?
          </div>
          <div class="collapse-content">
            <p>{vara.fasting}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Navigation -->
    <div class="flex flex-wrap justify-between gap-4 pt-4">
      <a
        href={`/vara/${prevVara.slug}`}
        class="btn btn-outline min-h-12"
      >
        ‚Üê {prevVara.nameHindi}
      </a>
      <a href="/vara" class="btn btn-ghost min-h-12">
        All Varas
      </a>
      <a
        href={`/vara/${nextVara.slug}`}
        class="btn btn-outline min-h-12"
      >
        {nextVara.nameHindi} ‚Üí
      </a>
    </div>
  </div>
</Layout>
