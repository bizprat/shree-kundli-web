---
/**
 * Individual Yoga Page
 *
 * Detailed page for each yoga with:
 * - Nature and deity information
 * - Recommended activities
 * - Things to avoid
 * - FAQ schema for AI extraction
 */
import Layout from '../../layouts/Layout.astro';
import Breadcrumb from '../../components/Breadcrumb.astro';
import type { BreadcrumbItem } from '../../lib/types';

// Load yogas data
import yogasData from '../../data/yogas.json';

interface Yoga {
  id: number;
  name: string;
  nameHindi: string;
  slug: string;
  meaning: string;
  meaningHindi: string;
  nature: string;
  natureHindi: string;
  deity: string;
  deityHindi: string;
  goodFor: string[];
  notGoodFor: string[];
  description: string;
  category: string;
}

const yogas = yogasData as Yoga[];

// Generate static paths
export async function getStaticPaths() {
  const yogasModule = await import('../../data/yogas.json');
  const yogas = yogasModule.default as Yoga[];

  return yogas.map((yoga) => ({
    params: { yoga: yoga.slug },
    props: { yoga },
  }));
}

// Get yoga from props
const { yoga } = Astro.props as { yoga: Yoga };

// Page meta
const title = `${yoga.name} Yoga (${yoga.nameHindi}) - ${yoga.meaning} | Panchang Guide | Shree Kundli`;
const description = `${yoga.name} (${yoga.nameHindi}) is the ${yoga.id}${yoga.id === 1 ? 'st' : yoga.id === 2 ? 'nd' : yoga.id === 3 ? 'rd' : 'th'} yoga in Panchang. ${yoga.description} Nature: ${yoga.nature}. Deity: ${yoga.deity}.`;

// Breadcrumbs
const breadcrumbs: BreadcrumbItem[] = [
  { name: 'Home', url: '/' },
  { name: 'Yoga', url: '/yoga' },
  { name: `${yoga.nameHindi} (${yoga.name})` },
];

// Article schema
const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: `${yoga.name} Yoga - ${yoga.nameHindi}`,
  description: description,
  author: {
    '@type': 'Organization',
    name: 'Shree Kundli',
  },
  about: {
    '@type': 'Thing',
    name: `${yoga.name} Yoga`,
    alternateName: yoga.nameHindi,
  },
  inLanguage: ['en', 'hi'],
};

// FAQ schema
const faqSchema = {
  '@context': 'https://schema.org',
  '@type': 'FAQPage',
  mainEntity: [
    {
      '@type': 'Question',
      name: `What is ${yoga.name} Yoga?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `${yoga.name} (${yoga.nameHindi}) is the ${yoga.id}${yoga.id === 1 ? 'st' : yoga.id === 2 ? 'nd' : yoga.id === 3 ? 'rd' : 'th'} yoga in Vedic Panchang. It means "${yoga.meaning}" and is ruled by ${yoga.deity}. Nature: ${yoga.nature}.`,
      },
    },
    {
      '@type': 'Question',
      name: `Is ${yoga.name} Yoga auspicious?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `${yoga.name} yoga is ${yoga.nature.toLowerCase()}. ${yoga.goodFor.length > 0 ? `It is good for: ${yoga.goodFor.join(', ')}.` : ''} ${yoga.notGoodFor.length > 0 ? `Avoid: ${yoga.notGoodFor.join(', ')}.` : ''}`,
      },
    },
    {
      '@type': 'Question',
      name: `What activities are recommended during ${yoga.name} Yoga?`,
      acceptedAnswer: {
        '@type': 'Answer',
        text: `During ${yoga.name} yoga, the following activities are favorable: ${yoga.goodFor.join(', ')}. ${yoga.notGoodFor.length > 0 ? `Activities to avoid: ${yoga.notGoodFor.join(', ')}.` : 'There are no specific activities to avoid.'}`,
      },
    },
  ],
};

// Get adjacent yogas for navigation
const currentIndex = yogas.findIndex(y => y.id === yoga.id);
const prevYoga = yogas[currentIndex - 1] || yogas[yogas.length - 1];
const nextYoga = yogas[currentIndex + 1] || yogas[0];

// Nature colors
const natureColors: Record<string, string> = {
  'Highly Auspicious': 'bg-green-500/20 text-green-700 border-green-500/30',
  'Auspicious': 'bg-green-500/10 text-green-600 border-green-500/20',
  'Mixed': 'bg-amber-500/10 text-amber-600 border-amber-500/20',
  'Inauspicious': 'bg-red-500/10 text-red-600 border-red-500/20',
  'Highly Inauspicious': 'bg-red-500/20 text-red-700 border-red-500/30',
};

// Category colors
const categoryColors: Record<string, string> = {
  'Sthira': 'bg-blue-500/10 text-blue-600 border-blue-500/20',
  'Chara': 'bg-purple-500/10 text-purple-600 border-purple-500/20',
  'Ugra': 'bg-red-500/10 text-red-600 border-red-500/20',
};

// Category descriptions
const categoryDescriptions: Record<string, string> = {
  'Sthira': 'Fixed yoga - suitable for permanent, long-lasting activities',
  'Chara': 'Movable yoga - suitable for dynamic, changing activities',
  'Ugra': 'Fierce yoga - suitable for aggressive, protective activities',
};

// Ordinal suffix helper
const getOrdinal = (n: number) => {
  if (n === 1) return 'st';
  if (n === 2) return 'nd';
  if (n === 3) return 'rd';
  return 'th';
};

// Nature emoji
const natureEmoji: Record<string, string> = {
  'Highly Auspicious': 'üåü',
  'Auspicious': '‚úì',
  'Mixed': '‚öñÔ∏è',
  'Inauspicious': '‚ö†Ô∏è',
  'Highly Inauspicious': '‚õî',
};
---

<Layout title={title} description={description}>
  <script is:inline type="application/ld+json" set:html={JSON.stringify(articleSchema)} slot="head" />
  <script is:inline type="application/ld+json" set:html={JSON.stringify(faqSchema)} slot="head" />

  <div class="space-y-8">
    <!-- Breadcrumb -->
    <Breadcrumb items={breadcrumbs} />

    <!-- Header -->
    <header>
      <div class="flex items-start gap-4">
        <div class={`text-center p-4 rounded-xl border ${natureColors[yoga.nature] || 'bg-base-200'}`}>
          <span class="text-3xl font-bold">{yoga.id}</span>
          <p class="text-xs mt-1 opacity-60">of 27</p>
        </div>
        <div>
          <h1 class="font-heading text-3xl md:text-4xl text-primary font-bold">
            {yoga.nameHindi}
          </h1>
          <p class="text-xl text-neutral/70 mt-1">
            {yoga.name} Yoga - {yoga.meaning}
          </p>
          <div class="flex flex-wrap items-center gap-2 mt-2">
            <span class={`text-sm px-2 py-0.5 rounded border ${natureColors[yoga.nature] || 'bg-base-200'}`}>
              {natureEmoji[yoga.nature]} {yoga.natureHindi}
            </span>
            <span class={`text-sm px-2 py-0.5 rounded border ${categoryColors[yoga.category] || 'bg-base-200'}`}>
              {yoga.category}
            </span>
          </div>
        </div>
      </div>
    </header>

    <!-- Quick Answer (AI Extraction Target) -->
    <section class="quick-answer" role="contentinfo">
      <div class={`card border ${natureColors[yoga.nature] || 'bg-base-200 border-base-300'}`}>
        <div class="card-body p-4 md:p-6">
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div>
              <p class="text-xs text-neutral/50 uppercase">Nature</p>
              <p class="font-semibold">{yoga.nature}</p>
              <p class="text-sm opacity-70">{yoga.natureHindi}</p>
            </div>
            <div>
              <p class="text-xs text-neutral/50 uppercase">Deity</p>
              <p class="font-semibold">{yoga.deity}</p>
              <p class="text-sm opacity-70">{yoga.deityHindi}</p>
            </div>
            <div>
              <p class="text-xs text-neutral/50 uppercase">Category</p>
              <p class="font-semibold">{yoga.category}</p>
            </div>
            <div>
              <p class="text-xs text-neutral/50 uppercase">Position</p>
              <p class="font-semibold">{yoga.id}{getOrdinal(yoga.id)} of 27</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- About This Yoga -->
    <section>
      <h2 class="font-heading text-2xl text-primary font-bold mb-4">
        About {yoga.name} Yoga
      </h2>
      <div class="prose prose-neutral max-w-none">
        <p class="text-lg leading-relaxed">
          <strong>{yoga.name}</strong> ({yoga.nameHindi}) is the {yoga.id}{getOrdinal(yoga.id)} yoga
          out of 27 yogas in the Vedic Panchang. The name means "<em>{yoga.meaning}</em>" ({yoga.meaningHindi}).
        </p>
        <p class="text-neutral/70 mt-3">
          {yoga.description}
        </p>
        <p class="text-neutral/70 mt-3">
          This yoga is ruled by <strong>{yoga.deity}</strong> ({yoga.deityHindi}) and belongs to the
          <strong class={`px-1 rounded ${categoryColors[yoga.category]}`}>{yoga.category}</strong> category.
          <span class="text-sm text-neutral/60"> ({categoryDescriptions[yoga.category]})</span>
        </p>
      </div>
    </section>

    <!-- Activities -->
    <section>
      <h2 class="font-heading text-2xl text-primary font-bold mb-4">
        Activities During {yoga.name} Yoga
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Good For -->
        <div class="card bg-green-500/5 border border-green-500/20">
          <div class="card-body p-4">
            <h3 class="font-semibold text-green-600 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd" />
              </svg>
              Recommended Activities
            </h3>
            <ul class="space-y-2">
              {yoga.goodFor.map((activity) => (
                <li class="flex items-start gap-2 text-sm">
                  <span class="text-green-500 mt-0.5">‚Ä¢</span>
                  <span class="text-neutral/70">{activity}</span>
                </li>
              ))}
            </ul>
          </div>
        </div>

        <!-- Not Good For -->
        <div class="card bg-red-500/5 border border-red-500/20">
          <div class="card-body p-4">
            <h3 class="font-semibold text-red-600 mb-3 flex items-center gap-2">
              <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
              </svg>
              Activities to Avoid
            </h3>
            <ul class="space-y-2">
              {yoga.notGoodFor.length > 0 ? (
                yoga.notGoodFor.map((activity) => (
                  <li class="flex items-start gap-2 text-sm">
                    <span class="text-red-500 mt-0.5">‚Ä¢</span>
                    <span class="text-neutral/70">{activity}</span>
                  </li>
                ))
              ) : (
                <li class="text-sm text-neutral/50">No specific restrictions for this yoga</li>
              )}
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- Detailed Information -->
    <section>
      <h2 class="font-heading text-xl text-primary font-semibold mb-4">
        Detailed Information
      </h2>
      <div class="card bg-base-200/50">
        <div class="card-body p-4">
          <table class="table table-sm">
            <tbody>
              <tr>
                <td class="text-neutral/60 w-40">Yoga Number</td>
                <td class="font-medium">{yoga.id} of 27</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Sanskrit Name</td>
                <td class="font-medium">{yoga.nameHindi}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">English Name</td>
                <td class="font-medium">{yoga.name}</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Meaning</td>
                <td class="font-medium">{yoga.meaning} ({yoga.meaningHindi})</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Ruling Deity</td>
                <td class="font-medium">{yoga.deity} ({yoga.deityHindi})</td>
              </tr>
              <tr>
                <td class="text-neutral/60">Nature</td>
                <td class={`font-medium ${yoga.nature.includes('Auspicious') && !yoga.nature.includes('Inauspicious') ? 'text-green-600' : yoga.nature.includes('Inauspicious') ? 'text-red-600' : 'text-amber-600'}`}>
                  {yoga.nature} ({yoga.natureHindi})
                </td>
              </tr>
              <tr>
                <td class="text-neutral/60">Category</td>
                <td class="font-medium">{yoga.category}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- FAQ Section -->
    <section>
      <h2 class="font-heading text-2xl text-primary font-bold mb-4">
        Frequently Asked Questions
      </h2>
      <div class="space-y-4">
        <div class="collapse collapse-arrow bg-base-200/50">
          <input type="radio" name="faq" checked />
          <div class="collapse-title font-medium">
            What is {yoga.name} Yoga?
          </div>
          <div class="collapse-content">
            <p>{yoga.name} ({yoga.nameHindi}) is the {yoga.id}{getOrdinal(yoga.id)} yoga in Vedic Panchang. It means "{yoga.meaning}" and is ruled by {yoga.deity}. Nature: {yoga.nature}.</p>
          </div>
        </div>

        <div class="collapse collapse-arrow bg-base-200/50">
          <input type="radio" name="faq" />
          <div class="collapse-title font-medium">
            Is {yoga.name} Yoga auspicious?
          </div>
          <div class="collapse-content">
            <p>{yoga.name} yoga is {yoga.nature.toLowerCase()}. {yoga.goodFor.length > 0 ? `It is good for: ${yoga.goodFor.join(', ')}.` : ''} {yoga.notGoodFor.length > 0 ? `Avoid: ${yoga.notGoodFor.join(', ')}.` : ''}</p>
          </div>
        </div>

        <div class="collapse collapse-arrow bg-base-200/50">
          <input type="radio" name="faq" />
          <div class="collapse-title font-medium">
            What activities are recommended during {yoga.name} Yoga?
          </div>
          <div class="collapse-content">
            <p>During {yoga.name} yoga, the following activities are favorable: {yoga.goodFor.join(', ')}. {yoga.notGoodFor.length > 0 ? `Activities to avoid: ${yoga.notGoodFor.join(', ')}.` : 'There are no specific activities to avoid.'}</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Navigation -->
    <div class="flex flex-wrap justify-between gap-4 pt-4">
      <a
        href={`/yoga/${prevYoga.slug}`}
        class="btn btn-outline min-h-12"
      >
        ‚Üê {prevYoga.nameHindi}
      </a>
      <a href="/yoga" class="btn btn-ghost min-h-12">
        All Yogas
      </a>
      <a
        href={`/yoga/${nextYoga.slug}`}
        class="btn btn-outline min-h-12"
      >
        {nextYoga.nameHindi} ‚Üí
      </a>
    </div>
  </div>
</Layout>
